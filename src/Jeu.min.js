"use strict";var JeuOmbre=JeuOmbre||{};JeuOmbre.JeuLvl=function(){this.ombre=null,this.pieces=null,this.ennemis=null,this.carteJeu=null,this.niveaux=null,0==JeuOmbre.cycleLvl&&(JeuOmbre.timer=130,JeuOmbre.score=0),this.fond=null,this.lesFleches=null,this.spaceKey=null,this.leScore,this.btnGOn=!1,this.btnDOn=!1,this.btnSOn=!1,this.btnBOn=!1},JeuOmbre.JeuLvl.prototype={init:function(){JeuOmbre.score=JeuOmbre.score},create:function(){JeuOmbre.mobile&&this.cntrMobile(),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.creerFond(),this.creerMondeJeu(),this.creerPerso(),this.creerEnnemi(),this.creerPieces(),this.lesFleches=this.game.input.keyboard.createCursorKeys(),this.spaceKey=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.game.input.keyboard.addKeyCapture(Phaser.Keyboard.SPACEBAR),this.physiqueJeu(),this.creerTimer(),this.afficherScore()},creerMondeJeu:function(){if(this.carteJeu=this.add.tilemap("carteJeu"),this.carteJeu.addTilesetImage("Tuile32_32"),this.niveaux={lvl0:this.carteJeu.createLayer("lvl"+JeuOmbre.cycleLvl)},this.niveaux.lvl0.resizeWorld(),this.carteJeu.setCollision([],!0,this.niveaux.lvl0),1==JeuOmbre.cycleLvl){var e;this.pSecret=[];for(var t=0;t<3;t++)(e=this.add.sprite(JeuOmbre.TAILLE_TUILE*(3+t),16*JeuOmbre.TAILLE_TUILE,"tuile32",1)).anchor.set(0),this.pSecret[t]=e;(e=this.add.sprite(5*JeuOmbre.TAILLE_TUILE,13*JeuOmbre.TAILLE_TUILE,"tuile32",0)).tint=13565843,this.pSecret[3]=e}JeuOmbre.mobile&&this.cntrMobile()},creerFond:function(){this.add.image(0,0,"Fond"+(JeuOmbre.cycleLvl+1)).anchor.set(0)},creerPerso:function(){2==JeuOmbre.cycleLvl?this.ombre=this.add.sprite(28.5*JeuOmbre.TAILLE_TUILE,JeuOmbre.TAILLE_TUILE,"ombre",0):this.ombre=this.add.sprite(1.5*JeuOmbre.TAILLE_TUILE,JeuOmbre.TAILLE_TUILE,"ombre",0),this.ombre.anchor.set(.5),this.ombre.animations.add("marche",[1,2,3,4],10,!0),this.ombre.animations.add("aGenoux",[5,6,7,8],4,!1),this.ombre.animations.add("marcheGenoux",[7,8],3,!1),this.ombre.animations.add("saut",[9,10,11,12,13,14,15,16],10,!1)},creerEnnemi:function(){var e,t,i,s,r,n,o,h=[4,4,5];this.ennemis=this.add.physicsGroup(Phaser.Physics.ARCADE),0==JeuOmbre.cycleLvl&&(r=h[JeuOmbre.cycleLvl],n=[[17,7],[1,8],[24,18],[19,18]],s=[200,250,50,100]),1==JeuOmbre.cycleLvl&&(r=h[JeuOmbre.cycleLvl],n=[[13,6],[11,9],[15,14],[15,11]],s=[125,150,150,250]),2==JeuOmbre.cycleLvl&&(r=h[JeuOmbre.cycleLvl],n=[[13,4],[13,6],[11,9],[15,14],[17,15]],s=[125,100,150,50,40]);for(var m=0;m<r;m++)e=(i=n[m])[0]*JeuOmbre.TAILLE_TUILE+JeuOmbre.TAILLE_TUILE/2,t=i[1]*JeuOmbre.TAILLE_TUILE+JeuOmbre.TAILLE_TUILE/2,(o=this.ennemis.create(e,t,"ennemiImg")).anchor.set(.5),o.body.setSize(25,25,3.5,3.5),o.animations.add("tourne",null,24,!0),o.play("tourne"),o.vitesse=s[m],o.body.velocity.x=o.vitesse,JeuOmbre.groupeE[m]=o},creerPieces:function(){var e,t,i,s,r;this.pieces=this.add.physicsGroup(Phaser.Physics.ARCADE),0==JeuOmbre.cycleLvl&&(r=(s=[[17,7],[1,8],[28,16],[19,16]]).length),1==JeuOmbre.cycleLvl&&(r=(s=[[4,11],[15,6],[16,9],[16,18],[19,14],[28,8]]).length),2==JeuOmbre.cycleLvl&&(r=(s=[[4,8],[12,9],[28,5],[15,15]]).length);for(var n,o=0;o<r;o++)e=(i=s[o])[0]*JeuOmbre.TAILLE_TUILE+JeuOmbre.TAILLE_TUILE/2,t=i[1]*JeuOmbre.TAILLE_TUILE+JeuOmbre.TAILLE_TUILE/2,(n=this.pieces.create(e,t,"etoileImg")).anchor.set(.5),n.body.setSize(25,25,3.5,3.5),n.animations.add("Zoom",null,12,!0),n.play("Zoom");JeuOmbre.totalPieces+=r},cntrMobile:function(){this.btnG=this.add.button(-10,0,"depGD"),this.btnG.alpha=0,this.btnG.onInputDown.add(function(){this.btnGOn=!this.btnGOn},this),this.btnG.onInputUp.add(function(){this.btnGOn=!this.btnGOn},this),this.btnD=this.add.button(this.game.width-202,0,"depGD"),this.btnD.alpha=0,this.btnD.onInputDown.add(function(){this.btnDOn=!this.btnDOn},this),this.btnD.onInputUp.add(function(){this.btnDOn=!this.btnDOn},this),this.btnS=this.add.button(this.game.width/2+2,0,"depS"),this.btnS.anchor.set(.5,0),this.btnS.alpha=0,this.btnS.onInputDown.add(function(){this.btnSOn=!this.btnSOn},this),this.btnS.onInputUp.add(function(){this.btnSOn=!this.btnSOn},this),this.btnB=this.add.button(0,this.game.height-150,"depB"),this.btnB.alpha=0,this.btnB.onInputDown.add(function(){this.btnBOn=!this.btnBOn},this),this.btnB.onInputUp.add(function(){this.btnBOn=!this.btnBOn},this)},creerTimer:function(){this.timer=this.game.time.create(!1),this.timer.start(),this.decompte=this.add.text(this.game.width/4,JeuOmbre.TAILLE_TUILE/4,"Temps restant: "+JeuOmbre.timer,{font:"20px monospace",fill:"#f70000",align:"center"}),this.timer.loop(1e3,this.updateTimer,this)},updateTimer:function(){JeuOmbre.timer--,this.decompte.setText("Temps restant :"+JeuOmbre.timer,!0)},afficherScore:function(){this.leScore=this.add.text(this.game.width/2,JeuOmbre.TAILLE_TUILE/4,"Score :"+JeuOmbre.score,{font:"20px monospace",fill:"#f70000",align:"center"})},physiqueJeu:function(){if(this.carteJeu.setCollisionBetween(1,1e3,!0,"lvl"+JeuOmbre.cycleLvl),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.physics.enable(this.niveaux.lvl0,Phaser.Physics.ARCADE),this.niveaux.lvl0.body.immovable=!0,1==JeuOmbre.cycleLvl)for(var e=this.pSecret.length,t=0;t<e;t++)this.game.physics.enable(this.pSecret[t],Phaser.Physics.ARCADE),this.pSecret[t].body.immovable=!0;this.game.physics.enable(this.ombre,Phaser.Physics.ARCADE),this.ombre.body.velocity.y=100,this.ombre.body.gravity.y=400,this.ombre.body.setSize(10,40,7.5,2.5),this.ombre.body.collideWorldBounds=!0,this.game.physics.enable(this.ennemis,Phaser.Physics.ARCADE),this.ennemis.setAll("body.immovable",!0)},update:function(){if(this.updateScore(),1==JeuOmbre.cycleLvl){for(var e=this.pSecret.length-1,t=0;t<e;t++)this.game.physics.arcade.collide(this.pSecret[t],this.ombre);this.game.physics.arcade.collide(this.pSecret[3],this.ombre,this.blockCompteur,null,this)}this.game.physics.arcade.collide(this.ombre,this.niveaux.lvl0),this.ombre.body.setSize(10,40,7.5,2.5),this.lesFleches.left.isDown||this.btnGOn?(this.ombre.scale.x=-1,this.lesFleches.down.isDown||this.btnBOn?(this.ombre.body.setSize(10,25,7.5,18),this.ombre.animations.play("marcheGenoux"),this.ombre.body.velocity.x=-JeuOmbre.VITESSE/3):this.spaceKey.isDown||this.btnSOn?this.game.time.now>JeuOmbre.tempsSaut&&(this.ombre.body.velocity.y=-250,JeuOmbre.nbrSaut+=1,JeuOmbre.tempsSaut=this.game.time.now+1e3,this.ombre.animations.play("saut")):(this.ombre.body.velocity.x=-JeuOmbre.VITESSE,this.ombre.animations.play("marche"))):this.lesFleches.right.isDown||this.btnDOn?(this.ombre.scale.x=1,this.lesFleches.down.isDown||this.btnBOn?(this.ombre.body.setSize(10,25,7.5,18),this.ombre.animations.play("marcheGenoux"),this.ombre.body.velocity.x=JeuOmbre.VITESSE/3):this.spaceKey.isDown||this.btnSOn?this.game.time.now>JeuOmbre.tempsSaut&&(this.ombre.body.velocity.y=-250,JeuOmbre.nbrSaut+=1,JeuOmbre.tempsSaut=this.game.time.now+1e3,this.ombre.animations.play("saut")):(this.ombre.animations.play("marche"),this.ombre.body.velocity.x=JeuOmbre.VITESSE)):this.spaceKey.isDown||this.btnSOn?this.game.time.now>JeuOmbre.tempsSaut&&(this.ombre.body.velocity.y=-250,this.ombre.animations.play("saut"),JeuOmbre.nbrSaut+=1,JeuOmbre.tempsSaut=this.game.time.now+1e3):this.lesFleches.down.isDown||this.btnBOn?(this.ombre.body.velocity.x=0,this.ombre.body.setSize(10,25,7.5,18),this.ombre.frame=8):(this.ombre.body.velocity.x=0,this.game.time.now<JeuOmbre.tempsSaut&&this.ombre.animations.play("saut"),this.ombre.frame=0),(this.spaceKey.isDown||this.btnSOn)&&JeuOmbre.nbrSaut<JeuOmbre.MAX_SAUT&&(JeuOmbre.sautTempo=this.game.time.now+1010),JeuOmbre.sautTempo<this.game.time.now&&JeuOmbre.nbrSaut>0&&(JeuOmbre.nbrSaut-=1),JeuOmbre.nbrSaut>=JeuOmbre.MAX_SAUT&&(JeuOmbre.tempsSaut=this.game.time.now+1500),this.game.physics.arcade.overlap(this.ombre,this.pieces,this.collectePieces,null,null),this.ombre.position.x>=37&&620==this.ombre.position.y&&0==JeuOmbre.cycleLvl&&(JeuOmbre.cycleLvl=JeuOmbre.cycleLvl+1,this.game.state.start("ChargerNiveau")),this.ombre.position.x>=869&&620==this.ombre.position.y&&1==JeuOmbre.cycleLvl&&(JeuOmbre.cycleLvl=JeuOmbre.cycleLvl+1,this.game.state.start("ChargerNiveau")),this.ombre.position.x>=330&&396==this.ombre.position.y&&1==JeuOmbre.cycleLvl&&!1===JeuOmbre.indice&&(this.motIndice=this.add.text(this.game.width/2,this.game.height/2,"Par 3 fois, un block différent doit être \ntouché pour ouvrir l'accès!",{font:"30px monospace",fill:"#fc0000",align:"center"}),this.motIndice.anchor.set(.5),JeuOmbre.tIndice=this.game.time.now+5e3,2==JeuOmbre.cycleLvl&&(JeuOmbre.indice=!0)),JeuOmbre.mobile&&JeuOmbre.indice&&this.game.time.now>JeuOmbre.tIndice&&this.motIndice.destroy(),JeuOmbre.indice&&this.game.time.now>JeuOmbre.tIndice&&this.motIndice.destroy(),this.ombre.position.x>=453&&this.ombre.position.x<=507&&620==this.ombre.position.y&&2==JeuOmbre.cycleLvl&&(JeuOmbre.cycleLvl=JeuOmbre.cycleLvl+1,this.game.state.start("FinJeu")),this.game.physics.arcade.collide(this.ennemis,this.ombre,this.Mort,null,this),JeuOmbre.timer<=0&&this.Mort(),this.game.physics.arcade.collide(this.ennemis,this.niveaux.lvl0,this.changerDirection,null,this)},collectePieces:function(e,t){1==t.alive&&(t.alive=!1,JeuOmbre.score=JeuOmbre.score+1,JeuOmbre.timer+=10,JeuOmbre.sonPiece.play(),t.destroy())},updateScore:function(e){this.leScore.setText("Score :"+JeuOmbre.score+"/"+JeuOmbre.totalPieces)},changerDirection:function(e){e.vitesse*=-1,e.body.velocity.x=e.vitesse},render:function(){},blockCompteur:function(){JeuOmbre.compteS+=1,3==JeuOmbre.compteS&&(this.pSecret[2].position.y+=2*JeuOmbre.TAILLE_TUILE,this.pSecret[2].position.x-=JeuOmbre.TAILLE_TUILE,this.pSecret[0].position.y+=JeuOmbre.TAILLE_TUILE,this.pSecret[1].position.y+=2*JeuOmbre.TAILLE_TUILE,this.pSecret[1].position.x-=JeuOmbre.TAILLE_TUILE)},Mort:function(e){JeuOmbre.sonMort.play(),this.game.state.start("FinJeu")},AllerFinJeu:function(e,t){this.game.state.start("FinJeu")}};